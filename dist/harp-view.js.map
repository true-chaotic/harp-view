{"version":3,"sources":["helpers/insertAfter.js","helpers/translate.js","helpers/tuneValid.js","helpers/createElement.js","viewer/index.js","vendor/ion.sound.js","player.js","helpers/noop.js","ticker.js","controller-view.js","helpers/isPause.js","controller.js","harp-view.js"],"names":["insertAfter","newNode","referenceNode","parentNode","insertBefore","nextSibling","translate","translations","lang","key","tuneValid","tune","Boolean","createElement","name","classes","listeners","element","document","classesArray","classList","add","Object","keys","forEach","event","addEventListener","styles","styleAdded","addStyles","style","innerHTML","head","appendChild","getNoteModifier","note","replace","baseContainerClass","baseNoteClass","activeClass","Viewer","notes","$column","$el","elements","split","reduce","result","index","arr","length","noteContainer","noteElement","innerText","highLighted","Set","dim","remove","delete","highLight","dimAll","window","navigator","$","undefined","ion","sound","warn","text","console","log","d","a","html","extend","parent","child","prop","hasOwnProperty","Audio","func","play","stop","pause","preload","destroy","is_iOS","i","test","appVersion","sounds_num","settings","sounds","supported","options","obj","path","volume","multiplay","loop","sprite","scope","ready_callback","ended_callback","alias","Sound","init","VERSION","_method","method","ionSound","AudioContext","audio","webkitAudioContext","request","streams","ext","url","loaded","decoded","no_file","autoplay","prototype","load","stream","buffer","removeEventListener","ready","bind","error","abort","createUrl","no_cache","Date","valueOf","encodeURIComponent","XMLHttpRequest","open","responseType","send","reload","data","target","readyState","status","decode","decodeAudioData","response","setBuffer","config","duration","call","start","end","Stream","part","setVolume","sprite_part","setLoop","source","gain","playing","paused","time_started","time_ended","time_played","time_offset","disconnect","update","createGain","createBufferSource","connect","destination","value","onended","ended","_play","clear","noteOn","noteOff","_ended","item","can_play_mp3","canPlayType","can_play_ogg","can_play_aac","splice","checkSupport","inited","_ready","_scope","start_time","paused_time","played_time","can_play_through","_update","rand","src","currentTime","e","current_time","setTimeout","looper","jQuery","Player","NOTES","SNAP","C","D","E","F","G","A","B","c","f","g","instance","GlobalPlayer","values","map","playNote","playSnap","noop","second","minute","Ticker","interval","ticksPerMinute","onTick","tpm","clearInterval","setInterval","ControllerView","onPlay","onStop","onClickSlower","onClickFaster","viewerElement","block","state","bpm","playButton","click","updateButton","controlSpeed","assign","display","margin","slowerBtn","fasterBtn","bpmElement","updateBpm","viewerContainer","maxWidth","updateElement","newState","entries","isPause","PAUSES","has","Controller","ticker","controllerView","tick","tuneIndex","ticksPerMinuteSteps","multiplier","Math","round","currentTicksStep","findIndex","modifiers","tuneArray","symbol","includes","pop","push","viewer","player","speedStep","increment","max","min","HarpView","selector","querySelectorAll","node","trim"],"mappings":"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","file":"harp-view.js","sourceRoot":"../src","sourcesContent":["/**\n * insertAfter helper\n *\n * @param {Element} newNode\n * @param {Element} referenceNode\n */\nexport default function insertAfter(newNode, referenceNode) {\n  referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n","const translations = {\n  'en': {\n    'error.bad-tune': \"Empty tune or unknown format\",\n    'play': 'Play',\n    'pause': 'Pause',\n    'stop': 'Stop'\n  },\n\n  'ru': {\n    'error.bad-tune': 'Пустая мелодия или ошибка в записи',\n    'play': 'Играть',\n    'pause': 'Пауза',\n    'stop': 'Остановить'\n  }\n};\n\nconst lang = 'en';\n\n/**\n * Translate by key\n *\n * @param key\n * @returns {string}\n */\nconst translate = key =>\n  translations\n  && translations[lang]\n  && translations[lang][key]\n  || key;\n\nexport default translate;\n","/**\n * Validates tune\n *  - not empty\n *  @TODO: conforms to chosen standard (e.g. abc)\n *\n * @param {string} tune\n * @returns {boolean}\n */\nexport default function tuneValid(tune) {\n  return Boolean(tune);\n}\n","/**\n * Creates element with class and listeners\n *\n * @param {string} name\n * @param {string|array} [classes=[]]\n * @param {object} [listeners={}]\n * @returns {Element}\n */\nexport default function createElement(name, classes = [], listeners = {}) {\n  const element = document.createElement(name);\n  const classesArray = typeof classes === 'string'\n    ? [classes]\n    : classes;\n\n  element.classList.add(...classesArray);\n\n  Object.keys(listeners).forEach(event => {\n    element.addEventListener(event, listeners[event]);\n  });\n\n  return element;\n}\n","import createElement from \"../helpers/createElement\";\n\nimport fs from 'fs';\nconst styles = fs.readFileSync(__dirname + '/notes-viewer.css', 'utf8');\n\nlet styleAdded = false;\n\nconst addStyles = () => {\n  if (styleAdded) {\n    return;\n  }\n\n  const style = document.createElement('style');\n\n  style.innerHTML = styles;\n\n  document.head.appendChild(style);\n\n  styleAdded = true;\n};\n\nconst getNoteModifier = note => note\n  .replace('\\'', '-high')\n  .replace(',', '-low');\n\nconst baseContainerClass = 'notes-viewer__container';\nconst baseNoteClass = 'notes-viewer__note';\nconst activeClass = `${baseNoteClass}_active`;\n\nexport default function Viewer() {\n  // const notes = \"F, C, D, E, F G A B c d e f | g a b c' d' e' f' g' a' x\";\n\n  const notes = \"| e c A F D B, G, E, D, C, F,, | x a g f d B G E C A, F, |\";\n\n  const $el = createElement('div', 'notes-viewer');\n\n  addStyles();\n\n  let $column;\n\n  const elements = notes\n    .split(' ')\n    .reduce((result, note, index, arr) => {\n      if (note === '|') {\n        if ($column) {\n          $el.appendChild($column);\n        }\n\n        if (index !== arr.length - 1) {\n          $column = createElement('ul', 'notes-viewer__column');\n        }\n      } else {\n        const noteContainer = createElement('li', [\n          baseContainerClass,\n          `${baseContainerClass}_${getNoteModifier(note)}`\n        ]);\n\n        const noteElement = createElement('span', baseNoteClass);\n        noteElement.innerText = note;\n\n        noteContainer.appendChild(noteElement);\n\n        $column.appendChild(noteContainer);\n\n        result[note] = noteElement;\n      }\n\n      return result;\n  }, {});\n\n  const highLighted = new Set();\n\n  function dim(note) {\n    if (elements[note]) {\n      elements[note].classList.remove(activeClass);\n\n      highLighted.delete(note);\n    }\n  }\n\n  function highLight(note) {\n    if (elements[note]) {\n      elements[note].classList.add(activeClass);\n\n      highLighted.add(note);\n    }\n  }\n\n  function dimAll() {\n    [...highLighted].forEach(dim);\n  }\n\n  return {\n    $el,\n    highLight,\n    dim,\n    dimAll\n  }\n}\n\n\n","/**\n * Ion.Sound\n * version 3.0.7 Build 89\n * © Denis Ineshin, 2016\n *\n * Project page:    http://ionden.com/a/plugins/ion.sound/en.html\n * GitHub page:     https://github.com/IonDen/ion.sound\n *\n * Released under MIT licence:\n * http://ionden.com/a/plugins/licence-en.html\n */\n\n;(function (window, navigator, $, undefined) {\n    \"use strict\";\n\n    window.ion = window.ion || {};\n\n    if (ion.sound) {\n        return;\n    }\n\n    var warn = function (text) {\n        if (!text) text = \"undefined\";\n\n        if (window.console) {\n            if (console.warn && typeof console.warn === \"function\") {\n                console.warn(text);\n            } else if (console.log && typeof console.log === \"function\") {\n                console.log(text);\n            }\n\n            var d = $ && $(\"#debug\");\n            if (d && d.length) {\n                var a = d.html();\n                d.html(a + text + '<br/>');\n            }\n        }\n    };\n\n    var extend = function (parent, child) {\n        var prop;\n        child = child || {};\n\n        for (prop in parent) {\n            if (parent.hasOwnProperty(prop)) {\n                child[prop] = parent[prop];\n            }\n        }\n\n        return child;\n    };\n\n\n\n    /**\n     * DISABLE for unsupported browsers\n     */\n\n    if (typeof Audio !== \"function\" && typeof Audio !== \"object\") {\n        var func = function () {\n            warn(\"HTML5 Audio is not supported in this browser\");\n        };\n        ion.sound = func;\n        ion.sound.play = func;\n        ion.sound.stop = func;\n        ion.sound.pause = func;\n        ion.sound.preload = func;\n        ion.sound.destroy = func;\n        func();\n        return;\n    }\n\n\n\n    /**\n     * CORE\n     * - creating sounds collection\n     * - public methods\n     */\n\n    var is_iOS = /iPad|iPhone|iPod/.test(navigator.appVersion),\n        sounds_num = 0,\n        settings = {},\n        sounds = {},\n        i;\n\n\n\n    if (!settings.supported && is_iOS) {\n        settings.supported = [\"mp3\", \"mp4\", \"aac\"];\n    } else if (!settings.supported) {\n        settings.supported = [\"mp3\", \"ogg\", \"mp4\", \"aac\", \"wav\"];\n    }\n\n    var createSound = function (obj) {\n        var name = obj.alias || obj.name;\n\n        if (!sounds[name]) {\n            sounds[name] = new Sound(obj);\n            sounds[name].init();\n        }\n    };\n\n    ion.sound = function (options) {\n        extend(options, settings);\n\n        settings.path = settings.path || \"\";\n        settings.volume = settings.volume || 1;\n        settings.preload = settings.preload || false;\n        settings.multiplay = settings.multiplay || false;\n        settings.loop = settings.loop || false;\n        settings.sprite = settings.sprite || null;\n        settings.scope = settings.scope || null;\n        settings.ready_callback = settings.ready_callback || null;\n        settings.ended_callback = settings.ended_callback || null;\n\n        sounds_num = settings.sounds.length;\n\n        if (!sounds_num) {\n            warn(\"No sound-files provided!\");\n            return;\n        }\n\n        for (i = 0; i < sounds_num; i++) {\n            createSound(settings.sounds[i]);\n        }\n    };\n\n    ion.sound.VERSION = \"3.0.7\";\n\n    ion.sound._method = function (method, name, options) {\n        if (name) {\n            sounds[name] && sounds[name][method](options);\n        } else {\n            for (i in sounds) {\n                if (!sounds.hasOwnProperty(i) || !sounds[i]) {\n                    continue;\n                }\n\n                sounds[i][method](options);\n            }\n        }\n    };\n\n    ion.sound.preload = function (name, options) {\n        options = options || {};\n        extend({preload: true}, options);\n\n        ion.sound._method(\"init\", name, options);\n    };\n\n    ion.sound.destroy = function (name) {\n        ion.sound._method(\"destroy\", name);\n\n        if (name) {\n            sounds[name] = null;\n        } else {\n            for (i in sounds) {\n                if (!sounds.hasOwnProperty(i)) {\n                    continue;\n                }\n                if (sounds[i]) {\n                    sounds[i] = null;\n                }\n            }\n        }\n    };\n\n    ion.sound.play = function (name, options) {\n        ion.sound._method(\"play\", name, options);\n    };\n\n    ion.sound.stop = function (name, options) {\n        ion.sound._method(\"stop\", name, options);\n    };\n\n    ion.sound.pause = function (name, options) {\n        ion.sound._method(\"pause\", name, options);\n    };\n\n    ion.sound.volume = function (name, options) {\n        ion.sound._method(\"volume\", name, options);\n    };\n\n    if ($) {\n        $.ionSound = ion.sound;\n    }\n\n\n\n    /**\n     * Web Audio API core\n     * - for most advanced browsers\n     */\n\n    var AudioContext = window.AudioContext || window.webkitAudioContext,\n        audio;\n\n    if (AudioContext) {\n        audio = new AudioContext();\n    }\n\n\n    var Sound = function (options) {\n        this.options = extend(settings);\n        delete this.options.sounds;\n        extend(options, this.options);\n\n        this.request = null;\n        this.streams = {};\n        this.result = {};\n        this.ext = 0;\n        this.url = \"\";\n\n        this.loaded = false;\n        this.decoded = false;\n        this.no_file = false;\n        this.autoplay = false;\n    };\n\n    Sound.prototype = {\n        init: function (options) {\n            if (options) {\n                extend(options, this.options);\n            }\n\n            if (this.options.preload) {\n                this.load();\n            }\n        },\n\n        destroy: function () {\n            var stream;\n\n            for (i in this.streams) {\n                stream = this.streams[i];\n\n                if (stream) {\n                    stream.destroy();\n                    stream = null;\n                }\n            }\n            this.streams = {};\n            this.result = null;\n            this.options.buffer = null;\n            this.options = null;\n\n            if (this.request) {\n                this.request.removeEventListener(\"load\", this.ready.bind(this), false);\n                this.request.removeEventListener(\"error\", this.error.bind(this), false);\n                this.request.abort();\n                this.request = null;\n            }\n        },\n\n        createUrl: function () {\n            var no_cache = new Date().valueOf();\n            this.url = this.options.path + encodeURIComponent(this.options.name) + \".\" + this.options.supported[this.ext] + \"?\" + no_cache;\n        },\n\n        load: function () {\n            if (this.no_file) {\n                warn(\"No sources for \\\"\" + this.options.name + \"\\\" sound :(\");\n                return;\n            }\n\n            if (this.request) {\n                return;\n            }\n\n            this.createUrl();\n\n            this.request = new XMLHttpRequest();\n            this.request.open(\"GET\", this.url, true);\n            this.request.responseType = \"arraybuffer\";\n            this.request.addEventListener(\"load\", this.ready.bind(this), false);\n            this.request.addEventListener(\"error\", this.error.bind(this), false);\n\n            this.request.send();\n        },\n\n        reload: function () {\n            this.ext++;\n\n            if (this.options.supported[this.ext]) {\n                this.load();\n            } else {\n                this.no_file = true;\n                warn(\"No sources for \\\"\" + this.options.name + \"\\\" sound :(\");\n            }\n        },\n\n        ready: function (data) {\n            this.result = data.target;\n\n            if (this.result.readyState !== 4) {\n                this.reload();\n                return;\n            }\n\n            if (this.result.status !== 200 && this.result.status !== 0) {\n                warn(this.url + \" was not found on server!\");\n                this.reload();\n                return;\n            }\n\n            this.request.removeEventListener(\"load\", this.ready.bind(this), false);\n            this.request.removeEventListener(\"error\", this.error.bind(this), false);\n            this.request = null;\n            this.loaded = true;\n            //warn(\"Loaded: \" + this.options.name + \".\" + settings.supported[this.ext]);\n\n            this.decode();\n        },\n\n        decode: function () {\n            if (!audio) {\n                return;\n            }\n\n            audio.decodeAudioData(this.result.response, this.setBuffer.bind(this), this.error.bind(this));\n        },\n\n        setBuffer: function (buffer) {\n            this.options.buffer = buffer;\n            this.decoded = true;\n            //warn(\"Decoded: \" + this.options.name + \".\" + settings.supported[this.ext]);\n\n            var config = {\n                name: this.options.name,\n                alias: this.options.alias,\n                ext: this.options.supported[this.ext],\n                duration: this.options.buffer.duration\n            };\n\n            if (this.options.ready_callback && typeof this.options.ready_callback === \"function\") {\n                this.options.ready_callback.call(this.options.scope, config);\n            }\n\n            if (this.options.sprite) {\n\n                for (i in this.options.sprite) {\n                    this.options.start = this.options.sprite[i][0];\n                    this.options.end = this.options.sprite[i][1];\n                    this.streams[i] = new Stream(this.options, i);\n                }\n\n            } else {\n\n                this.streams[0] = new Stream(this.options);\n\n            }\n\n            if (this.autoplay) {\n                this.autoplay = false;\n                this.play();\n            }\n        },\n\n        error: function () {\n            this.reload();\n        },\n\n        play: function (options) {\n            delete this.options.part;\n\n            if (options) {\n                extend(options, this.options);\n            }\n\n            if (!this.loaded) {\n                this.autoplay = true;\n                this.load();\n\n                return;\n            }\n\n            if (this.no_file || !this.decoded) {\n                return;\n            }\n\n            if (this.options.sprite) {\n                if (this.options.part) {\n                    this.streams[this.options.part].play(this.options);\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].play(this.options);\n                    }\n                }\n            } else {\n                this.streams[0].play(this.options);\n            }\n        },\n\n        stop: function (options) {\n            if (this.options.sprite) {\n\n                if (options) {\n                    this.streams[options.part].stop();\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].stop();\n                    }\n                }\n\n            } else {\n                this.streams[0].stop();\n            }\n        },\n\n        pause: function (options) {\n            if (this.options.sprite) {\n\n                if (options) {\n                    this.streams[options.part].pause();\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].pause();\n                    }\n                }\n\n            } else {\n                this.streams[0].pause();\n            }\n        },\n\n        volume: function (options) {\n            var stream;\n\n            if (options) {\n                extend(options, this.options);\n            } else {\n                return;\n            }\n\n            if (this.options.sprite) {\n                if (this.options.part) {\n                    stream = this.streams[this.options.part];\n                    stream && stream.setVolume(this.options);\n                } else {\n                    for (i in this.options.sprite) {\n                        stream = this.streams[i];\n                        stream && stream.setVolume(this.options);\n                    }\n                }\n            } else {\n                stream = this.streams[0];\n                stream && stream.setVolume(this.options);\n            }\n        }\n    };\n\n\n\n    var Stream = function (options, sprite_part) {\n        this.alias = options.alias;\n        this.name = options.name;\n        this.sprite_part = sprite_part;\n\n        this.buffer = options.buffer;\n        this.start = options.start || 0;\n        this.end = options.end || this.buffer.duration;\n        this.multiplay = options.multiplay || false;\n        this.volume = options.volume || 1;\n        this.scope = options.scope;\n        this.ended_callback = options.ended_callback;\n\n        this.setLoop(options);\n\n        this.source = null;\n        this.gain = null;\n        this.playing = false;\n        this.paused = false;\n\n        this.time_started = 0;\n        this.time_ended = 0;\n        this.time_played = 0;\n        this.time_offset = 0;\n    };\n\n    Stream.prototype = {\n        destroy: function () {\n            this.stop();\n\n            this.buffer = null;\n            this.source = null;\n\n            this.gain && this.gain.disconnect();\n            this.source && this.source.disconnect();\n            this.gain = null;\n            this.source = null;\n        },\n\n        setLoop: function (options) {\n            if (options.loop === true) {\n                this.loop = 9999999;\n            } else if (typeof options.loop === \"number\") {\n                this.loop = +options.loop - 1;\n            } else {\n                this.loop = false;\n            }\n        },\n\n        update: function (options) {\n            this.setLoop(options);\n            if (\"volume\" in options) {\n                this.volume = options.volume;\n            }\n        },\n\n        play: function (options) {\n            if (options) {\n                this.update(options);\n            }\n\n            if (!this.multiplay && this.playing) {\n                return;\n            }\n\n            this.gain = audio.createGain();\n            this.source = audio.createBufferSource();\n            this.source.buffer = this.buffer;\n            this.source.connect(this.gain);\n            this.gain.connect(audio.destination);\n            this.gain.gain.value = this.volume;\n\n            this.source.onended = this.ended.bind(this);\n\n            this._play();\n        },\n\n        _play: function () {\n            var start,\n                end;\n\n            if (this.paused) {\n                start = this.start + this.time_offset;\n                end = this.end - this.time_offset;\n            } else {\n                start = this.start;\n                end = this.end;\n            }\n\n            if (end <= 0) {\n                this.clear();\n                return;\n            }\n\n            if (typeof this.source.start === \"function\") {\n                this.source.start(0, start, end);\n            } else {\n                this.source.noteOn(0, start, end);\n            }\n\n            this.playing = true;\n            this.paused = false;\n            this.time_started = new Date().valueOf();\n        },\n\n        stop: function () {\n            if (this.playing && this.source) {\n                if (typeof this.source.stop === \"function\") {\n                    this.source.stop(0);\n                } else {\n                    this.source.noteOff(0);\n                }\n            }\n\n            this.clear();\n        },\n\n        pause: function () {\n            if (this.paused) {\n                this.play();\n                return;\n            }\n\n            if (!this.playing) {\n                return;\n            }\n\n            this.source && this.source.stop(0);\n            this.paused = true;\n        },\n\n        ended: function () {\n            this.playing = false;\n            this.time_ended = new Date().valueOf();\n            this.time_played = (this.time_ended - this.time_started) / 1000;\n            this.time_offset += this.time_played;\n\n            if (this.time_offset >= this.end || this.end - this.time_offset < 0.015) {\n                this._ended();\n                this.clear();\n\n                if (this.loop) {\n                    this.loop--;\n                    this.play();\n                }\n            }\n        },\n\n        _ended: function () {\n            var config = {\n                name: this.name,\n                alias: this.alias,\n                part: this.sprite_part,\n                start: this.start,\n                duration: this.end\n            };\n\n            if (this.ended_callback && typeof this.ended_callback === \"function\") {\n                this.ended_callback.call(this.scope, config);\n            }\n        },\n\n        clear: function () {\n            this.time_played = 0;\n            this.time_offset = 0;\n            this.paused = false;\n            this.playing = false;\n        },\n\n        setVolume: function (options) {\n            this.volume = options.volume;\n\n            if (this.gain) {\n                this.gain.gain.value = this.volume;\n            }\n        }\n    };\n\n    if (audio) {\n        return;\n    }\n\n\n\n    /**\n     * Fallback for HTML5 audio\n     * - for not so modern browsers\n     */\n\n    var checkSupport = function () {\n        var sound = new Audio(),\n            can_play_mp3 = sound.canPlayType('audio/mpeg'),\n            can_play_ogg = sound.canPlayType('audio/ogg'),\n            can_play_aac = sound.canPlayType('audio/mp4; codecs=\"mp4a.40.2\"'),\n            item, i;\n\n        for (i = 0; i < settings.supported.length; i++) {\n            item = settings.supported[i];\n\n            if (!can_play_mp3 && item === \"mp3\") {\n                settings.supported.splice(i, 1);\n            }\n\n            if (!can_play_ogg && item === \"ogg\") {\n                settings.supported.splice(i, 1);\n            }\n\n            if (!can_play_aac && item === \"aac\") {\n                settings.supported.splice(i, 1);\n            }\n\n            if (!can_play_aac && item === \"mp4\") {\n                settings.supported.splice(i, 1);\n            }\n        }\n\n        sound = null;\n    };\n    checkSupport();\n\n\n\n    Sound.prototype = {\n        init: function (options) {\n            if (options) {\n                extend(options, this.options);\n            }\n\n            this.inited = true;\n\n            if (this.options.preload) {\n                this.load();\n            }\n        },\n\n        destroy: function () {\n            var stream;\n\n            for (i in this.streams) {\n                stream = this.streams[i];\n\n                if (stream) {\n                    stream.destroy();\n                    stream = null;\n                }\n            }\n            this.streams = {};\n            this.loaded = false;\n            this.inited = false;\n        },\n\n        load: function () {\n            var part;\n\n            this.options.preload = true;\n            this.options._ready = this.ready;\n            this.options._scope = this;\n\n            if (this.options.sprite) {\n\n                for (i in this.options.sprite) {\n                    part = this.options.sprite[i];\n\n                    this.options.start = part[0];\n                    this.options.end = part[1];\n\n                    this.streams[i] = new Stream(this.options, i);\n                }\n\n            } else {\n\n                this.streams[0] = new Stream(this.options);\n\n            }\n        },\n\n        ready: function (duration) {\n            if (this.loaded) {\n                return;\n            }\n\n            this.loaded = true;\n\n            var config = {\n                name: this.options.name,\n                alias: this.options.alias,\n                ext: this.options.supported[this.ext],\n                duration: duration\n            };\n\n            if (this.options.ready_callback && typeof this.options.ready_callback === \"function\") {\n                this.options.ready_callback.call(this.options.scope, config);\n            }\n\n            if (this.autoplay) {\n                this.autoplay = false;\n                this.play();\n            }\n        },\n\n        play: function (options) {\n            if (!this.inited) {\n                return;\n            }\n\n            delete this.options.part;\n\n            if (options) {\n                extend(options, this.options);\n            }\n\n            console.log(1);\n            if (!this.loaded) {\n                if (!this.options.preload) {\n                    this.autoplay = true;\n                    this.load();\n                } else {\n                    this.autoplay = true;\n                }\n\n                return;\n            }\n\n            if (this.options.sprite) {\n                if (this.options.part) {\n                    this.streams[this.options.part].play(this.options);\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].play(this.options);\n                    }\n                }\n            } else {\n                this.streams[0].play(this.options);\n            }\n        },\n\n        stop: function (options) {\n            if (!this.inited) {\n                return;\n            }\n\n            if (this.options.sprite) {\n\n                if (options) {\n                    this.streams[options.part].stop();\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].stop();\n                    }\n                }\n\n            } else {\n                this.streams[0].stop();\n            }\n        },\n\n        pause: function (options) {\n            if (!this.inited) {\n                return;\n            }\n\n            if (this.options.sprite) {\n\n                if (options) {\n                    this.streams[options.part].pause();\n                } else {\n                    for (i in this.options.sprite) {\n                        this.streams[i].pause();\n                    }\n                }\n\n            } else {\n                this.streams[0].pause();\n            }\n        },\n\n        volume: function (options) {\n            var stream;\n\n            if (options) {\n                extend(options, this.options);\n            } else {\n                return;\n            }\n\n            if (this.options.sprite) {\n                if (this.options.part) {\n                    stream = this.streams[this.options.part];\n                    stream && stream.setVolume(this.options);\n                } else {\n                    for (i in this.options.sprite) {\n                        stream = this.streams[i];\n                        stream && stream.setVolume(this.options);\n                    }\n                }\n            } else {\n                stream = this.streams[0];\n                stream && stream.setVolume(this.options);\n            }\n        }\n    };\n\n\n\n    Stream = function (options, sprite_part) {\n        this.name = options.name;\n        this.alias = options.alias;\n        this.sprite_part = sprite_part;\n\n        this.multiplay = options.multiplay;\n        this.volume = options.volume;\n        this.preload = options.preload;\n        this.path = settings.path;\n        this.start = options.start || 0;\n        this.end = options.end || 0;\n        this.scope = options.scope;\n        this.ended_callback = options.ended_callback;\n\n        this._scope = options._scope;\n        this._ready = options._ready;\n\n        this.setLoop(options);\n\n        this.sound = null;\n        this.url = null;\n        this.loaded = false;\n\n        this.start_time = 0;\n        this.paused_time = 0;\n        this.played_time = 0;\n\n        this.init();\n    };\n\n    Stream.prototype = {\n        init: function () {\n            this.sound = new Audio();\n            this.sound.volume = this.volume;\n\n            this.createUrl();\n\n            this.sound.addEventListener(\"ended\", this.ended.bind(this), false);\n            this.sound.addEventListener(\"canplaythrough\", this.can_play_through.bind(this), false);\n            this.sound.addEventListener(\"timeupdate\", this._update.bind(this), false);\n\n            this.load();\n        },\n\n        destroy: function () {\n            this.stop();\n\n            this.sound.removeEventListener(\"ended\", this.ended.bind(this), false);\n            this.sound.removeEventListener(\"canplaythrough\", this.can_play_through.bind(this), false);\n            this.sound.removeEventListener(\"timeupdate\", this._update.bind(this), false);\n\n            this.sound = null;\n            this.loaded = false;\n        },\n\n        createUrl: function () {\n            var rand = new Date().valueOf();\n            this.url = this.path + encodeURIComponent(this.name) + \".\" + settings.supported[0] + \"?\" + rand;\n        },\n\n        can_play_through: function () {\n            if (this.preload) {\n                this.ready();\n            }\n        },\n\n        load: function () {\n            this.sound.src = this.url;\n            this.sound.preload = this.preload ? \"auto\" : \"none\";\n            if (this.preload) {\n                this.sound.load();\n            }\n        },\n\n        setLoop: function (options) {\n            if (options.loop === true) {\n                this.loop = 9999999;\n            } else if (typeof options.loop === \"number\") {\n                this.loop = +options.loop - 1;\n            } else {\n                this.loop = false;\n            }\n        },\n\n        update: function (options) {\n            this.setLoop(options);\n\n            if (\"volume\" in options) {\n                this.volume = options.volume;\n            }\n        },\n\n        ready: function () {\n            if (this.loaded || !this.sound) {\n                return;\n            }\n\n            this.loaded = true;\n            this._ready.call(this._scope, this.sound.duration);\n\n            if (!this.end) {\n                this.end = this.sound.duration;\n            }\n        },\n\n        play: function (options) {\n            if (options) {\n                this.update(options);\n            }\n\n            if (!this.multiplay && this.playing) {\n                return;\n            }\n\n            this._play();\n        },\n\n        _play: function () {\n            if (this.paused) {\n                this.paused = false;\n            } else {\n                try {\n                    this.sound.currentTime = this.start;\n                } catch (e) {}\n            }\n\n            this.playing = true;\n            this.start_time = new Date().valueOf();\n            this.sound.volume = this.volume;\n            this.sound.play();\n        },\n\n        stop: function () {\n            if (!this.playing) {\n                return;\n            }\n\n            this.playing = false;\n            this.paused = false;\n            this.sound.pause();\n            this.clear();\n\n            try {\n                this.sound.currentTime = this.start;\n            } catch (e) {}\n        },\n\n        pause: function () {\n            if (this.paused) {\n                this._play();\n            } else {\n                this.playing = false;\n                this.paused = true;\n                this.sound.pause();\n                this.paused_time = new Date().valueOf();\n                this.played_time += this.paused_time - this.start_time;\n            }\n        },\n\n        _update: function () {\n            if (!this.start_time) {\n                return;\n            }\n\n            var current_time = new Date().valueOf(),\n                played_time = current_time - this.start_time,\n                played = (this.played_time + played_time) / 1000;\n\n            if (played >= this.end) {\n                if (this.playing) {\n                    this.stop();\n                    this._ended();\n                }\n            }\n        },\n\n        ended: function () {\n            if (this.playing) {\n                this.stop();\n                this._ended();\n            }\n        },\n\n        _ended: function () {\n            this.playing = false;\n\n            var config = {\n                name: this.name,\n                alias: this.alias,\n                part: this.sprite_part,\n                start: this.start,\n                duration: this.end\n            };\n\n            if (this.ended_callback && typeof this.ended_callback === \"function\") {\n                this.ended_callback.call(this.scope, config);\n            }\n\n            if (this.loop) {\n                setTimeout(this.looper.bind(this), 15);\n            }\n        },\n\n        looper: function () {\n            this.loop--;\n            this.play();\n        },\n\n        clear: function () {\n            this.start_time = 0;\n            this.played_time = 0;\n            this.paused_time = 0;\n        },\n\n        setVolume: function (options) {\n            this.volume = options.volume;\n\n            if (this.sound) {\n                this.sound.volume = this.volume;\n            }\n        }\n    };\n\n} (window, navigator, window.jQuery || window.$));\n","import './vendor/ion.sound';\n\nconst NOTES = {\n  SNAP: 'snap',\n\n  \"F,,\": 'F0',\n\n  \"C,\": 'C1',\n  \"D,\": 'D1',\n  \"E,\": 'E1',\n  \"F,\": 'F1',\n  \"G,\": 'G1',\n  \"A,\": 'A1',\n  \"B,\": 'B1',\n\n  C: 'C2',\n  D: 'D2',\n  E: 'E2',\n  F: 'F2',\n  G: 'G2',\n  A: 'A2',\n  B: 'B2',  \n  \n  c: 'C3',\n  d: 'D3',\n  e: 'E3',\n  f: 'F3',\n  g: 'G3',\n  a: 'A3',\n};\n\nconst Player = (function () {\n  let instance;\n\n  function GlobalPlayer() {\n    const ion = window.ion;\n\n    ion.sound({\n      sounds: Object.values(NOTES).map(name => ({\n        name,\n        volume: name === NOTES.SNAP\n          ? 1.0\n          : 0.3\n      })),\n      path: \"sounds/\",\n      preload: true,\n      multiplay: true\n    });\n\n    return {\n      playNote: (note) => {\n        if (NOTES[note]) {\n          ion.sound.play(NOTES[note]);\n        }\n      },\n      playSnap: () => {\n        ion.sound.play(NOTES.SNAP);\n      },\n    }\n  }\n\n  return function() {\n    if (!instance) {\n      instance = new GlobalPlayer();\n    }\n\n    return instance;\n  }\n}());\n\nexport default Player;\n","export default function noop() {}\n","const second = 1000;\nconst minute = second * 60;\nimport noop from \"./helpers/noop\";\n\nexport default function Ticker({\n  ticksPerMinute = 60,\n  onTick = noop\n} = {}) {\n  let tpm = ticksPerMinute;\n  let interval;\n\n  function stop() {\n    clearInterval(interval);\n\n    interval = null;\n  }\n\n  function start() {\n    stop();\n\n    interval = setInterval(onTick, minute / tpm);\n  }\n\n  function update({ticksPerMinute}) {\n    tpm = ticksPerMinute;\n\n    if (interval) {\n      start();\n    }\n  }\n\n  return {\n    start,\n    stop,\n    update\n  }\n}\n","import noop from \"./helpers/noop\";\nimport createElement from \"./helpers/createElement\";\nimport __ from \"./helpers/translate\";\n\nexport default function ControllerView({\n  onPlay = noop,\n  onStop = noop,\n  onClickSlower = noop,\n  onClickFaster = noop,\n  viewerElement,\n  block = 'harp-view',\n  bpm\n} = {}) {\n  const state = {\n    playing: false,\n    bpm\n  };\n\n  const $el = createElement('div', block);\n  const playButton = createElement('button', `${block}__play`, {\n    click: function() {\n      if (!state.playing) {\n        onPlay();\n      } else {\n        onStop();\n      }\n    }\n  });\n\n  function updateButton() {\n    playButton.innerText = __(!state.playing ? 'play' : 'stop');\n  }\n\n  updateButton();\n\n  const controlSpeed = createElement('span', `${block}__control-speed`);\n  Object.assign(controlSpeed.style, {\n    display: 'inline-block',\n    margin: '0 1em'\n  });\n\n  const slowerBtn = createElement('button', `${block}__speed-button`, {\n    click: onClickSlower\n  });\n  slowerBtn.innerText = __('slower');\n\n  const fasterBtn = createElement('button', `${block}__speed-button`, {\n    click: onClickFaster\n  });\n  fasterBtn.innerText = __('faster');\n\n  const bpmElement = createElement('span', `${block}__bpm`);\n  Object.assign(bpmElement.style, {\n    display: 'inline-block',\n    margin: '0 0.5em'\n  });\n\n  function updateBpm() {\n    bpmElement.innerText = state.bpm || '';\n  }\n\n  controlSpeed.appendChild(slowerBtn);\n  controlSpeed.appendChild(bpmElement);\n  controlSpeed.appendChild(fasterBtn);\n\n  updateBpm();\n\n  $el.appendChild(playButton);\n  $el.appendChild(controlSpeed);\n\n  const viewerContainer = createElement('div', `${block}__viewer`);\n  Object.assign(viewerContainer.style, {\n    maxWidth: '320px',\n    margin: '0 auto'\n  });\n\n  viewerContainer.appendChild(viewerElement);\n  $el.appendChild(viewerContainer);\n\n  const updateElement = {\n    playing: updateButton,\n    bpm: updateBpm\n  };\n\n  function update(newState) {\n    Object.entries(newState).forEach(([key, value]) => {\n      if (state[key] !== value) {\n        state[key] = value;\n\n        updateElement[key]();\n      }\n    });\n  }\n\n  return {\n    $el,\n    update\n  }\n}\n","const PAUSES = new Set(['x', 'z']);\n\nconst isPause = note => PAUSES.has(note);\n\nexport default isPause;\n","import Viewer from './viewer';\nimport Player from './player';\nimport Ticker from './ticker';\nimport ControllerView from \"./controller-view\";\nimport isPause from './helpers/isPause';\n\nexport default function Controller({tune}) {\n  let tick = -1;\n  let tuneIndex = -1;\n  let ticksPerMinute = 120 * 4;\n\n  const ticksPerMinuteSteps = [0.2, 0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6, 1.8, 2, 2.5, 3, 3.5, 4]\n    .map(multiplier => Math.round(ticksPerMinute * multiplier));\n\n  let currentTicksStep = ticksPerMinuteSteps.findIndex(tpm => tpm === ticksPerMinute);\n\n  const modifiers = ['\\'', ','];\n\n  const tuneArray = tune\n    .split('')\n    .reduce((result, symbol) => {\n      let note = modifiers.includes(symbol)\n        ? result.pop() + symbol\n        : symbol;\n\n      result.push(note);\n\n      return result;\n    }, []);\n  const ticksPerSnap = 4;\n  const ticksPerNote = 2;\n  const highLightTicks = 1;\n\n  const viewer = new Viewer();\n  const player = new Player();\n\n  const playAndShow = () => {\n    const note = tuneArray[tuneIndex];\n\n    viewer.dimAll();\n\n    if (isPause(note)) {\n      return;\n    }\n\n    player.playNote(note);\n    viewer.highLight(note);\n  };\n\n  let ticker;\n  let controllerView;\n\n  const stop = () => {\n    tick = -1;\n    tuneIndex = -1;\n\n    controllerView.update({playing: false});\n    ticker.stop();\n    viewer.dimAll();\n  };\n\n  const onTick = () => {\n    tick += 1;\n\n    if (tick % ticksPerNote === highLightTicks) {\n      viewer.dimAll();\n    }\n\n    if (tick % ticksPerNote === 0) {\n      tuneIndex += 1;\n\n      if (tuneIndex === tuneArray.length) {\n        return stop();\n      }\n\n      playAndShow();\n    }\n\n    if (tick % ticksPerSnap === 0) {\n      player.playSnap();\n    }\n  };\n\n  ticker = new Ticker({\n    ticksPerMinute,\n    onTick\n  });\n\n  const speedStep = (increment) => {\n    currentTicksStep = Math.max(0, Math.min((currentTicksStep + increment), ticksPerMinuteSteps.length - 1));\n\n    ticksPerMinute = ticksPerMinuteSteps[currentTicksStep];\n\n    ticker.update({ticksPerMinute});\n    controllerView.update({bpm: ticksPerMinute / ticksPerSnap});\n  };\n\n  controllerView = new ControllerView({\n    viewerElement: viewer.$el,\n\n    bpm: ticksPerMinute / ticksPerSnap,\n\n    onClickFaster() {\n      speedStep(+1);\n    },\n\n    onClickSlower() {\n      speedStep(-1);\n    },\n\n    onPlay() {\n      controllerView.update({playing: true});\n\n      ticker.start();\n    },\n    onStop: stop\n  });\n\n  return controllerView.$el;\n}\n","import insertAfter from './helpers/insertAfter';\nimport __ from './helpers/translate';\nimport tuneValid from './helpers/tuneValid';\nimport Controller from \"./controller\";\n\nwindow.HarpView = function(selector) {\n  document.querySelectorAll('.' + selector).forEach(node => {\n    const tune = node.innerHTML.trim();\n\n    if (!tuneValid(tune)) {\n      console.error(__('error.bad-tune'), node);\n\n      return;\n    }\n\n    insertAfter(new Controller({tune}), node);\n  });\n};\n"]}